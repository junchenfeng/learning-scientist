<!DOCTYPE html>
<html>
  <head>
    <title>Learning Science Bootcamp</title>
    <meta charset="utf-8">
    <meta name="author" content="冯俊晨" />
    <link href="ols_files/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Learning Science Bootcamp
## Ordinary Least Square
### 冯俊晨
### 2018/09/11

---




---
# OLS的基本公式

`$$\Large Y=\beta X+\epsilon$$`
其中 `\(Y\)` 表示**自变量**, `\(X\)`表示**因变量**（矩阵），这都是常量

`\(\epsilon\)` 是**随机干扰**(有时又被称为残差项)，这是个随机变量


---
class: middle

# 教育回报
.pull-left[
模型（或者叫数据生成过程）
`$$\Large Income=\beta Edu+\epsilon$$`
]
.pull-right[
估计结果
`$$\Large Income=\hat{\beta} Edu$$`

注意到
- `\(\beta\)`上的帽子表示估计值
- `\(\epsilon\)` "消失"了
- 事实上 `\(\hat{\beta}\)` 是 `\(\epsilon\)` 的函数，因此它是个随机变量
]


---
# 教育回报 

.pull-left[
数据来源：中国家庭金融调研(2013)，有收入的成年人，未经调权


```
## 
## ================================================
##                         Dependent variable:     
##                     ----------------------------
##                                income           
## ------------------------------------------------
## edu                    3,520.073*** (76.053)    
## Constant              -4,970.804*** (922.144)   
## ------------------------------------------------
## Observations                   23,436           
## R2                             0.084            
## Adjusted R2                    0.084            
## Residual Std. Error   42,395.930 (df = 23434)   
## F Statistic         2,142.225*** (df = 1; 23434)
## ================================================
## Note:                *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```
]
.pull-right[
- 每增加一年教育，工资涨3520
- 模型解释了收入数据8.4%的变化
- 参数估计的标准误是76.053
]
---
# log转化

.pull-left[
`$$\Large log(Income)=\beta Edu+\epsilon$$`


```
## 
## ================================================
##                         Dependent variable:     
##                     ----------------------------
##                             log(income)         
## ------------------------------------------------
## edu                       0.080*** (0.002)      
## Constant                  9.176*** (0.021)      
## ------------------------------------------------
## Observations                   23,436           
## R2                             0.080            
## Adjusted R2                    0.080            
## Residual Std. Error      0.984 (df = 23434)     
## F Statistic         2,040.636*** (df = 1; 23434)
## ================================================
## Note:                *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```
]
.pull-right[
- 每增加一年教育，工资涨8%
]

---
# 离散变量



```
## 
## ===============================================
##                         Dependent variable:    
##                     ---------------------------
##                             log(income)        
## -----------------------------------------------
## xueliprimary             0.247*** (0.054)      
## xuelisecondary           0.407*** (0.052)      
## xuelihighschool          0.572*** (0.052)      
## xuelicollege             0.965*** (0.052)      
## xuelimaster+             1.515*** (0.067)      
## Constant                 9.473*** (0.051)      
## -----------------------------------------------
## Observations                  23,436           
## R2                             0.086           
## Adjusted R2                    0.086           
## Residual Std. Error     0.981 (df = 23430)     
## F Statistic         440.083*** (df = 5; 23430) 
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```

---
# 离散变量

和没上过学的相比

- 上过小学的**多**赚24.7%
- 上过初中的**多**赚40.7%

综上推论：和上过小学的相比，上过初中的大约多赚16%

**思考**：之前教育年限的线性假设合理么？

---

# 遗漏变量

收入不仅和受教育年限有关，跟工作经验也有关。定义工作经验为年龄-受教育年限

`$$\Large log(Income)=\beta_1 Edu+\beta_2 Exp+\epsilon$$`


```
## 
## ================================================
##                         Dependent variable:     
##                     ----------------------------
##                             log(income)         
## ------------------------------------------------
## edu                       0.090*** (0.002)      
## exp                       0.007*** (0.001)      
## Constant                  8.896*** (0.034)      
## ------------------------------------------------
## Observations                   23,436           
## R2                             0.084            
## Adjusted R2                    0.084            
## Residual Std. Error      0.981 (df = 23433)     
## F Statistic         1,080.025*** (df = 2; 23433)
## ================================================
## Note:                *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```
---

# 线性模型中的非线性元素

`$$\Large log(Income)=\beta_1 Edu+\beta_2 Exp+\beta_3 Exp^2+\epsilon$$`
**思考** 经验对工资的影响是什么？



```
## 
## ===============================================
##                         Dependent variable:    
##                     ---------------------------
##                             log(income)        
## -----------------------------------------------
## edu                      0.088*** (0.002)      
## exp                      0.038*** (0.003)      
## exp2                    -0.001*** (0.00005)    
## Constant                 8.574*** (0.042)      
## -----------------------------------------------
## Observations                  23,436           
## R2                             0.091           
## Adjusted R2                    0.091           
## Residual Std. Error     0.978 (df = 23432)     
## F Statistic         779.081*** (df = 3; 23432) 
## ===============================================
## Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```


---

# 比较模型
- 变量的不同阶次（exp的平方项）
- 变量的不同形式（edu VS xueli）


```
## 
## ========================================================================
##                                   Dependent variable:                   
##                 --------------------------------------------------------
## ------------------------------------------------------------------------
## edu             0.080*** (0.002)  0.088*** (0.002)                      
## xueliprimary                                           0.116** (0.056)  
## xuelisecondary                                        0.283*** (0.055)  
## xuelihighschool                                       0.474*** (0.055)  
## xuelicollege                                          0.903*** (0.056)  
## xuelimaster+                                          1.477*** (0.070)  
## exp                               0.038*** (0.003)    0.043*** (0.003)  
## exp2                             -0.001*** (0.00005) -0.001*** (0.00005)
## Constant        9.176*** (0.021)  8.574*** (0.042)    9.020*** (0.059)  
## ------------------------------------------------------------------------
## Adjusted R2          0.080              0.091               0.097       
## ========================================================================
## Note:                                        *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```

---

# 上述模型还有什么问题？

- 遗漏变量：其他影响工资的因素
- 模型形式：edu和exp是否线性可加？比如是否存在edu和exp的交互项
- (*)错误的标准误

- **内生性** 
一种特殊的遗漏变量错误。残差项和自变量相关！

.pull-left[
真实模型
`$$\Large Y = \alpha Edu + \gamma IQ + \eta$$`
`$$\Large Edu = \delta IQ + \xi$$`
]

.pull-right[
回归模型
`$$\Large Y = \beta Edu + \epsilon$$`
]

---
# 为什么我们还要用OLS

All models are wrong, but some are useful. By George P Box

- （主要的）因果推断工具
- 大部分情况下，简单的OLS就能做到60分；不能超过OLS就可以洗洗睡了
- 业界和学界的通用语言：统计学方向和社会科学方向必修

我们这里介绍OLS的主要目的是用来做之前学过的很多统计检验

---
# OLS假设检验(1)

四个组：

- 长视频 (long video)
- 短视频 (short video)
- 轻交互 (interactive)
- 控制组 (control)

两道题:

- 类题 (similar)
- 简单变式 (transfer)

---
# OLS假设检验(2)

```
## 
## ======================================================================
##                                     Dependent variable:               
##                      -------------------------------------------------
##                              similar                  transfer        
## ----------------------------------------------------------------------
## course_idinteractive          0.108                    0.149          
##                           p = 0.0001***            p = 0.00000***     
##                                                                       
## course_idlong_video           0.179                    0.197          
##                            p = 0.000***             p = 0.000***      
##                                                                       
## course_idshort_video          0.054                    0.056          
##                             p = 0.085*               p = 0.075*       
##                                                                       
## Constant                      0.269                    0.310          
##                            p = 0.000***             p = 0.000***      
##                                                                       
## ----------------------------------------------------------------------
## Observations                  2,101                    2,203          
## R2                            0.018                    0.024          
## Adjusted R2                   0.017                    0.022          
## Residual Std. Error     0.475 (df = 2097)        0.487 (df = 2199)    
## F Statistic          12.774*** (df = 3; 2097) 17.759*** (df = 3; 2199)
## ======================================================================
## Note:                                      *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01
```

---
# OLS中的假设检验

H0: 对于类题而言，短视频的教学效果和控制组一样

```r
linearHypothesis(similar_stat,
                 "course_idshort_video = 0")
```

```
## Linear hypothesis test
## 
## Hypothesis:
## course_idshort_video = 0
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq     F  Pr(&gt;F)  
## 1   2098 473.44                             
## 2   2097 472.77  1   0.67071 2.975 0.08471 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

H0：对于类题而言，短视频的教学效果比控制组高5%

```r
linearHypothesis(similar_stat,
                 "course_idshort_video = 0.05")
```

```
## Linear hypothesis test
## 
## Hypothesis:
## course_idshort_video = 0.05
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1   2098 472.77                           
## 2   2097 472.77  1 0.0042044 0.0186 0.8914
```

---

H0：对于类题而言，长视频的教学效果和轻交互一样好

```r
linearHypothesis(similar_stat,
                 "course_idlong_video = course_idinteractive")
```

```
## Linear hypothesis test
## 
## Hypothesis:
## - course_idinteractive  + course_idlong_video = 0
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
## 1   2098 474.19                              
## 2   2097 472.77  1    1.4202 6.2993 0.01215 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

---

H0：对于类题而言，长视频的教学效果比轻交互好5%


```r
linearHypothesis(similar_stat,
                 "course_idlong_video -course_idinteractive = 0.05")
```

```
## Linear hypothesis test
## 
## Hypothesis:
## - course_idinteractive  + course_idlong_video = 0.05
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1   2098 472.89                           
## 2   2097 472.77  1   0.12416 0.5507 0.4581
```

---

H0：对于迁移而言，长视频的教学效果比轻交互好1%


```r
linearHypothesis(transfer_stat,
                 "course_idlong_video - course_idinteractive = 0.01")
```

```
## Linear hypothesis test
## 
## Hypothesis:
## - course_idinteractive  + course_idlong_video = 0.01
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1   2200 522.56                           
## 2   2199 522.14  1   0.41843 1.7622 0.1845
```

---

H0： 交互手段和教学效果无关 (Pearson Test)


```r
linearHypothesis(transfer_stat, 
                 c("course_idlong_video = 0",
                   "course_idinteractive =0",
                   "course_idshort_video=0"))
```

```
## Linear hypothesis test
## 
## Hypothesis:
## course_idlong_video = 0
## course_idinteractive = 0
## course_idshort_video = 0
## 
## Model 1: restricted model
## Model 2: master ~ course_id
## 
##   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1   2202 534.79                                  
## 2   2199 522.14  3     12.65 17.759 2.173e-11 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
